<!DOCTYPE HTML>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head th:include="console/header">
</head>
<body>
<style>
    .textbox {
        width: 100% !important;
    }
</style>
<section class="content">
    <div class="row">
        <div class="col-md-6 col-md-offset-1">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title" th:text="调货"></h3>
                </div>
                <div class="box-body">
                    <form class="form-horizontal js-ajax-form" action="/console/transfer/save" method="post">
                        <input type="hidden" name="id" id="id" th:value="${transferInfo.id}" />
                        <!--<input type="hidden" name="createdAt" th:value="${adjust.createdat}" />-->
                        <!--<input type="hidden" name="updatedAt" th:value="${adjust.updatedat}" />-->
                        <div class="form-group">
                            <label for="bizno" class="col-sm-2 control-label">单据号</label>
                            <div class="col-sm-10">
                                <input type="text" name="bizno" class="form-control" id="bizno"
                                       th:readonly="${1==1}"
                                       th:value="${transferInfo.bizno}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="orderUnit" class="col-sm-2 control-label">订货单位</label>
                            <div class="col-sm-10">
                                <input type="text" name="orderunit" class="form-control" id="orderUnit"
                                       th:readonly="${1==1}"
                                       th:value="${transferInfo.orderunit}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ordertime" class="col-sm-2 control-label">出货时间</label>
                            <div class="col-sm-10">
                                <input type="text" name="ordertime" class="form-control" id="ordertime"
                                       th:readonly="${1==1}"
                                       th:value="${#dates.format(transferInfo.ordertime,'yyyy-MM-dd HH:mm:ss')}"/>
                            </div>
                        </div>
                        <!--<div class="form-group">
                            <label for="productname" class="col-sm-2 control-label">产品名称</label>
                            <div class="col-sm-10">
                                <input type="text" name="productName" class="form-control" id="productname"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="manufacture" class="col-sm-2 control-label">厂家</label>
                            <div class="col-sm-10">
                                <input type="text" name="manufacture" class="form-control" id="manufacture"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="unit" class="col-sm-2 control-label">单位</label>
                            <div class="col-sm-10">
                                <input type="text" name="unit" class="form-control" id="unit"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="quantity" class="col-sm-2 control-label">数量</label>
                            <div class="col-sm-10">
                                <input type="text" name="quantity" class="form-control" id="quantity"/>
                            </div>
                        </div>-->

                        <div class="form-group">
                            <label for="transferunit" class="col-sm-2 control-label">调货单位</label>
                            <div class="col-sm-10">
                                <input type="text" name="transferunit" class="form-control" id="transferunit"
                                       th:readonly="${1==1}"
                                       th:value="${transferInfo.transferunit}"/>
                            </div>
                        </div>
                        <div class="form-group"
                                th:hidden="${!#strings.equals(transferInfo.state,1)}">
                            <label for="transferman" class="col-sm-2 control-label">调货员</label>
                            <div class="col-sm-10">
                                <input type="text" name="transferman" class="form-control" id="transferman"
                                th:value="${transferInfo.transferman}"
                                />

                            </div>
                        </div>
                        <!--<div class="form-group">
                            <label for="transferTimeBegin" class="col-sm-2 control-label">调货开始</label>
                            <div class="col-sm-10">
                                <input type="text" name="transferTimeBegin" class="form-control" id="transferTimeBegin"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="transferTimeEnd" class="col-sm-2 control-label">调货截止</label>
                            <div class="col-sm-10">
                                <input type="text" name="transferTimeEnd" class="form-control" id="transferTimeEnd"/>
                            </div>
                        </div>-->

                        <div class="form-group"
                             th:hidden="${!#strings.equals(transferInfo.state,3)}">
                            <label for="fetchGoodsMan" class="col-sm-2 control-label">拿货员</label>
                            <div class="col-sm-10">
                                <input type="text" name="fetchGoodsMan" class="form-control" id="fetchGoodsMan"
                                       th:value="${transferInfo.fetchGoodsMan}"/>
                            </div>
                        </div>

                        <div class="form-group"
                             th:hidden="${!#strings.equals(transferInfo.state,5)}">
                            <label for="dataMan" class="col-sm-2 control-label">开单员</label>
                            <div class="col-sm-10">
                                <input type="text" name="dataMan" class="form-control" id="dataMan"
                                       th:value="${transferInfo.dataMan}"/>
                            </div>
                        </div>
                       <!-- <div class="form-group">
                            <label for="purchabillno" class="col-sm-2 control-label">采购单号</label>
                            <div class="col-sm-10">
                                <input type="text" name="purchabillno" class="form-control" id="purchabillno"/>
                            </div>
                        </div>-->
                       <!-- <div class="form-group">
                            <label for="purchaDataBegin" class="col-sm-2 control-label">采购数据开始</label>
                            <div class="col-sm-10">
                                <input type="text" name="purchaDataBegin" class="form-control" id="purchaDataBegin"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="purchaDataEnd" class="col-sm-2 control-label">采购数据截止</label>
                            <div class="col-sm-10">
                                <input type="text" name="purchaDataEnd" class="form-control" id="purchaDataEnd"/>
                            </div>
                        </div>-->
                        <div class="form-group"
                             th:hidden="${!#strings.equals(transferInfo.state,7)}">
                            <label for="checkMan" class="col-sm-2 control-label">验货员</label>
                            <div class="col-sm-10">
                                <input type="text" name="checkMan" class="form-control" id="checkMan"
                                       th:value="${transferInfo.checkMan}"/>
                            </div>
                        </div>
                        <div class="form-group"
                             th:hidden="${!#strings.equals(transferInfo.state,9)}">
                            <label for="recheckMan" class="col-sm-2 control-label">复核员</label>
                            <div class="col-sm-10">
                                <input type="text" name="recheckMan" class="form-control" id="recheckMan"
                                       th:value="${transferInfo.recheckMan}"/>
                            </div>
                        </div>
                        <!--<div class="form-group">
                            <label for="checkBegin" class="col-sm-2 control-label">验货开始</label>
                            <div class="col-sm-10">
                                <input type="text" name="checkBegin" class="form-control" id="checkBegin"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="checkEnd" class="col-sm-2 control-label">验货截止</label>
                            <div class="col-sm-10">
                                <input type="text" name="checkEnd" class="form-control" id="checkEnd"/>
                            </div>
                        </div>-->
                        <div class="form-group"
                             th:hidden="${!#strings.equals(transferInfo.state,'11')}">
                            <label for="packMan" class="col-sm-2 control-label">打包员</label>
                            <div class="col-sm-10">
                                <input type="text" name="packMan" class="form-control" id="packMan"
                                       th:value="${transferInfo.packMan}"/>
                            </div>
                        </div>
                        <div class="form-group"
                             th:hidden="${!#strings.equals(transferInfo.state,'13')}">
                            <label for="deliveryMan" class="col-sm-2 control-label">送货员</label>
                            <div class="col-sm-10">
                                <input type="text" name="deliveryMan" class="form-control" id="deliveryMan"
                                       th:value="${transferInfo.deliveryMan}"/>
                            </div>
                        </div>
                        <!--<div class="form-group">
                            <label for="distribBegin" class="col-sm-2 control-label">配送开始</label>
                            <div class="col-sm-10">
                                <input type="text" name="distribBegin" class="form-control" id="distribBegin"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="distribEnd" class="col-sm-2 control-label">配送截止</label>
                            <div class="col-sm-10">
                                <input type="text" name="distribEnd" class="form-control" id="distribEnd"/>
                            </div>
                        </div>-->
                        <div class="form-group">
                            <label for="receiveAddress" class="col-sm-2 control-label">收货地址</label>
                            <div class="col-sm-10">
                                <input type="text" name="receiveAddress" class="form-control" id="receiveAddress"
                                       th:readonly="${1==1}"
                                       th:value="${transferInfo.receiveAddress}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="receiveTime" class="col-sm-2 control-label">发出时间</label>
                            <div class="col-sm-10">
                                <input type="text" name="receiveTime" class="form-control" id="receiveTime"
                                       th:readonly="${1==1}"
                                       th:value="${#dates.format(transferInfo.receiveTime,'yyyy-MM-dd HH:mm:ss')}"/>
                            </div>
                        </div>
                       <!-- <div class="form-group">
                            <label for="receiveMan" class="col-sm-2 control-label">收货人</label>
                            <div class="col-sm-10">
                                <input type="text" name="receiveMan" class="form-control" id="receiveMan"
                                       th:readonly="${1==1}"
                                       th:value="${transferInfo.receiveMan}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sendoutTime" class="col-sm-2 control-label">收货时间</label>
                            <div class="col-sm-10">
                                <input type="text" name="receiveEndTime" class="form-control" id="sendoutTime"
                                       th:readonly="${1==1}"
                                       th:value="${transferInfo.receiveEndTime}"/>
                            </div>
                        </div>-->
                        <div class="form-group">
                            <label for="state" class="col-sm-2 control-label">状态</label>
                            <div class="col-sm-10">
                                <input type="text" name="state" class="form-control" id="state"
                                       th:readonly="${1==1}"
                                       th:value="${transferInfo.state}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <!--<button type="submit" class="btn btn-default js-ajax-submit">提交</button>-->
                                <button type="button" id="start" class="btn btn-default col-md-3 js-ajax-submit">开始</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<div th:include="console/footer"></div>
</body>

<script type="text/javascript">

    $(function () {
        btn_submit();
        change_btn_text();
        initCalendar("#ordertime");
        initCalendar("#receiveTime");

        createEmpSelect("#transferman",2);
        createEmpSelect("#fetchGoodsMan",3);
        createEmpSelect("#dataMan",2);
        createEmpSelect("#checkMan",1);
        createEmpSelect("#recheckMan",1);
        createEmpSelect("#packMan",3);
        createEmpSelect("#deliveryMan",3);

    });



    function initCalendar(eid) {
        $(eid).jeDate({
            format: "YYYY-MM-DD hh:mm:ss"
        });
    }

    function intiCalendarWithTime(eid){
        $(eid).jeDate({
            format: "YYYY-MM-DD hh:mm:ss",
            isinitVal:true
        });
    }

    function change_btn_text(){
        var billstate = $("#state").val();//单据状态
        billstate = isNaN(parseInt(billstate)) ? 0 : parseInt(billstate);
        if(billstate % 2 == 0 ){
            $("#start").text("结束");
        }
    }

    function createEmpSelect(nid,type) {
        $(nid).combobox({
            // url: '/console/employee/combobox',
            url: '/console/employee/getAllEmpsByDept?type='+type,
            valueField: 'empName',
            textField: 'empName',
            onLoadSuccess: function (result) {
                console.log(result);
                var emplist = result.result.emplist || [];
                $(nid).combobox('loadData', emplist);
            }
        });
    }

    function btn_submit() {
        $('#start').on('click', function () {
            var id = $("#id").val(); //主键
            var transferman = $("#transferman").val(); //调货人
            var fetchGoodsMan = $('#fetchGoodsMan').val(); //拿货人
            var dataMan = $('#dataMan').val(); //开单人
            var checkMan = $('#checkMan').val(); //验货人
            var recheckMan = $('#recheckMan').val(); //复核人
            var packMan = $("#packMan").val(); //打包人
            var deliveryMan = $('#deliveryMan').val(); //送货人
            //var state = $('#state').val();//状态


            var data = {
                id:id,
                transferman:transferman,
                fetchGoodsMan:fetchGoodsMan,
                dataMan: dataMan,
                checkMan: checkMan,
                recheckMan: recheckMan,
                packMan: packMan,
                deliveryMan: deliveryMan,
            };

            var url = '/console/transfer/save';

            $.ajax({
                url: url,
                type: 'post',
                data: data,
                dataType: 'json',
                success: function (result) {
                    console.log(result);
                    if (result.referer) {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                        var opt = {
                            url: "/console/transfer/getAllTransferInfoWithNoDone",
                            silent: true,
                            query:{
                                type:1,
                                level:2
                            }
                        };
                        parent.$table.bootstrapTable('refresh', opt);
                    }
                    /*var url = "/console/receipt/index"
                    location.href = url;*/
                }

            })

        });
    }

</script>
</html>